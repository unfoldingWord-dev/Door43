<!--
* Name: button_obs_notes.html
* Description: The html and javascript that implements the UI for the Create OBS Notes plugin.
*
* This comment block will be removed by the plugin before rendering.
*
* Author: Phil Hopper
* Date:   2015-07-29
-->
<button id="obsCreateNotesButton">@createObsNotesButtonText@</button>
<p id="obsCreateNotesMessage" style="display: none;">&nbsp;</p>
<script type="text/javascript">
    jQuery(function($) {
        $('#obsCreateNotesButton').on('click', function() {
            var src = $('#selectObsSource').val();
            var dest = $('#selectObsDestination').val();
            if (dest) {
                // find the iso code in the text
                var found = dest.match(/\([^\(\)]+\)$/);
                if (found && found.length === 1) {
                    dest = found[0].replace(/\(|\)/g, '');
                }
            }
            // check data before submitting
            if (!src) return;
            if (!dest) return;
            var url = DOKU_BASE + 'lib/exe/ajax.php';
            var dataValues = {
                call: 'create_obs_notes',
                sourceLang: src,
                destinationLang: dest
            };
            var ajaxSettings = {
                type: 'POST',
                url: url,
                data: dataValues
            };
            $.ajax(ajaxSettings).done(function (data) {
                var msg = $('#obsCreateNotesMessage');
                msg.html(data);
                msg.show();
            });
        })
    }(jQuery));
</script>